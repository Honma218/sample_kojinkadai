<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://www.w3.org/1999/xhtml"
        layout:decorate="~{layout}">
<head>
    <title>フォロワー</title>
    <meta name="description" content="フォロワー一覧">
</head>
<body>
<div layout:fragment="layoutContent">
    <h2>フォロワー</h2>
    
    <div th:if="${#lists.isEmpty(users)}" class="no-users">
        <p>フォロワーはいません</p>
    </div>
    
    <div th:each="user : ${users}" class="user-item">
        <div class="user-info">
            <h4><a th:href="@{/profile/{id}(id=${user.id.value})}" th:text="${user.displayName.value}">表示名</a></h4>
            <p class="username">@<span th:text="${user.username}">username</span></p>
            <p class="bio" th:text="${user.bio}">自己紹介</p>
        </div>
        <div class="user-actions">
            <button class="btn btn-primary follow-back-btn" 
                    th:data-user-id="${user.id.value}">フォローバック</button>
        </div>
    </div>
    
    <div class="navigation">
        <a th:href="@{/profile}" class="btn btn-secondary">プロフィールに戻る</a>
    </div>
<script>
document.querySelectorAll('.follow-back-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const userId = this.dataset.userId;
        fetch(`/follow/${userId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.text())
        .then(data => {
            alert(data);
            this.textContent = 'フォロー中';
            this.className = 'btn btn-secondary';
            this.disabled = true;
        })
        .catch(error => {
            console.error('Error:', error);
            alert('エラーが発生しました');
        });
    });
});
</script>
</div>
</body>
</html>